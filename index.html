<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Skin + Baju Minecraft (Offline)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1b1b29;
      color: white;
      text-align: center;
      padding: 20px;
    }
    input, select, button {
      margin: 10px;
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      transition: 0.3s;
    }
    button {
      background-color: #3a3af5;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #5a5aff;
      transform: scale(1.05);
    }
    button:disabled {
      background-color: #444;
      cursor: not-allowed;
      transform: none;
    }
    canvas {
      background: #333;
      margin-top: 15px;
      image-rendering: pixelated;
      border-radius: 10px;
    }
    /* Progress bar */
    #progressContainer {
      width: 80%;
      height: 16px;
      background: #444;
      border-radius: 10px;
      margin: 15px auto;
      display: none;
      overflow: hidden;
    }
    #progressBar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #76ff03);
      border-radius: 10px;
      transition: width 0.2s ease;
    }
    #status {
      margin-top: 10px;
      font-size: 14px;
      color: #bbb;
    }
  </style>
</head>
<body>
  <h2>ðŸ§¥ Tambah Baju ke Skin Minecraft</h2>

  <label>Pilih model:</label>
  <select id="model">
    <option value="steve">Steve (Wide)</option>
    <option value="alex">Alex (Slim)</option>
  </select><br>

  <label>Upload Skin Anda:</label>
  <input type="file" id="skinInput" accept="image/png"><br>

  <button id="processBtn">Pasang Baju</button>
  <button id="downloadBtn" disabled>Download Skin Jadi</button>

  <!-- Progress bar -->
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
  <div id="status"></div>

  <canvas id="canvas" width="64" height="64"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const skinInput = document.getElementById("skinInput");
    const processBtn = document.getElementById("processBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const modelSelect = document.getElementById("model");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const statusText = document.getElementById("status");

    const outfitImg = new Image();
    outfitImg.src = "template.png"; // file permanen di folder sama

    outfitImg.onerror = () => {
      statusText.textContent = "âš ï¸ Gagal memuat template.png. Pastikan file-nya ada di folder yang sama.";
      processBtn.disabled = false;
    };

    function readFile(input, callback) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => callback(e.target.result);
        reader.readAsDataURL(input.files[0]);
      } else {
        statusText.textContent = "âš ï¸ Silakan pilih file skin terlebih dahulu!";
        processBtn.disabled = false;
      }
    }

    function showProgress(callback) {
      progressContainer.style.display = "block";
      progressBar.style.width = "0%";
      statusText.textContent = "â³ Memproses...";
      let progress = 0;

      const interval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            progressContainer.style.display = "none";
            statusText.textContent = "";
            callback();
          }, 300);
        }
        progressBar.style.width = progress + "%";
      }, 200);

      // keamanan: auto stop setelah 5 detik
      setTimeout(() => {
        if (progress < 100) {
          clearInterval(interval);
          progressBar.style.width = "100%";
          progressContainer.style.display = "none";
          statusText.textContent = "";
          callback();
        }
      }, 5000);
    }

    processBtn.onclick = () => {
      processBtn.disabled = true;
      downloadBtn.disabled = true;
      showProgress(() => {
        readFile(skinInput, (skinSrc) => {
          const skinImg = new Image();
          skinImg.onload = () => {
            outfitImg.onload = () => {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              ctx.drawImage(skinImg, 0, 0);

              const model = modelSelect.value;

              // Hapus layer ke-2 (outer layer)
              if (model === "steve") {
                ctx.clearRect(16, 32, 24, 16);
                ctx.clearRect(40, 32, 16, 16);
                ctx.clearRect(48, 48, 16, 16);
              } else {
                ctx.clearRect(16, 32, 24, 16);
                ctx.clearRect(36, 32, 12, 16);
                ctx.clearRect(44, 48, 12, 16);
              }

              // Tambahkan baju permanen
              ctx.drawImage(outfitImg, 0, 0);

              statusText.textContent = "âœ… Selesai! Klik Download untuk menyimpan.";
              processBtn.disabled = false;
              downloadBtn.disabled = false;
            };
          };
          skinImg.src = skinSrc;
        });
      });
    };

    downloadBtn.onclick = () => {
      const link = document.createElement("a");
      link.download = "skin_jadi.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    };
  </script>
</body>
</html>