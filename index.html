<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Skin + Baju Minecraft (Offline)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1b1b29;
      color: white;
      text-align: center;
      padding: 20px;
    }
    input, select, button {
      margin: 10px;
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      transition: 0.3s;
    }
    button:hover {
      background: #3b3b58;
      cursor: pointer;
    }
    canvas {
      background: #333;
      margin-top: 15px;
      image-rendering: pixelated;
      border-radius: 10px;
    }
    #progressContainer {
      width: 80%;
      background: #2a2a3d;
      border-radius: 10px;
      margin: 10px auto;
      height: 14px;
      overflow: hidden;
      display: none;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #00bfff;
      transition: width 0.2s;
    }
    #statusText {
      margin-top: 8px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h2>ðŸ§¥ Tambah Baju ke Skin Minecraft</h2>

  <label>Pilih model:</label>
  <select id="model">
    <option value="steve">Steve (Wide)</option>
    <option value="alex">Alex (Slim)</option>
  </select><br>

  <label>Upload Skin Anda:</label>
  <input type="file" id="skinInput" accept="image/png"><br>

  <button id="processBtn">Pasang Baju</button>
  <button id="downloadBtn" disabled>Download Skin Jadi</button>

  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
  <div id="statusText"></div>

  <canvas id="canvas" width="64" height="64"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const skinInput = document.getElementById("skinInput");
    const processBtn = document.getElementById("processBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const modelSelect = document.getElementById("model");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const statusText = document.getElementById("statusText");

    const outfitImg = new Image();
    outfitImg.src = "./template.png"; // file permanen

    outfitImg.onerror = () => {
      statusText.textContent = "âŒ Gagal memuat template.png. Pastikan file ada di folder yang sama.";
    };

    function readFile(input, callback) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onloadstart = () => updateProgress(10, "Membaca file skin...");
        reader.onprogress = e => {
          if (e.lengthComputable) {
            const percent = Math.min(10 + (e.loaded / e.total) * 20, 30);
            updateProgress(percent, "Membaca skin...");
          }
        };
        reader.onload = e => callback(e.target.result);
        reader.readAsDataURL(input.files[0]);
      }
    }

    function updateProgress(percent, text) {
      progressContainer.style.display = "block";
      progressBar.style.width = percent + "%";
      statusText.textContent = text;
    }

    processBtn.onclick = () => {
      if (!skinInput.files[0]) {
        alert("Silakan upload file skin dulu!");
        return;
      }

      downloadBtn.disabled = true;
      updateProgress(0, "Menyiapkan...");

      const model = modelSelect.value;
      readFile(skinInput, (skinSrc) => {
        const skinImg = new Image();

        skinImg.onload = () => {
          updateProgress(60, "Memuat skin...");
          outfitImg.onload = () => {
            updateProgress(80, "Menggabungkan...");

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(skinImg, 0, 0);

            // Hapus layer ke-2 (outer layer)
            if (model === "steve") {
              ctx.clearRect(16, 32, 24, 16);
              ctx.clearRect(40, 32, 16, 16);
              ctx.clearRect(48, 48, 16, 16);
            } else {
              ctx.clearRect(16, 32, 24, 16);
              ctx.clearRect(36, 32, 12, 16);
              ctx.clearRect(44, 48, 12, 16);
            }

            // Tambahkan baju
            ctx.drawImage(outfitImg, 0, 0);
            updateProgress(100, "âœ… Selesai! Klik Download Skin Jadi.");
            downloadBtn.disabled = false;
          };
          outfitImg.src = "./template.png";
        };

        skinImg.onerror = () => {
          updateProgress(0, "âŒ File skin tidak valid.");
        };

        updateProgress(40, "Memuat gambar skin...");
        skinImg.src = skinSrc;
      });
    };

    downloadBtn.onclick = () => {
      const link = document.createElement("a");
      link.download = "skin_jadi.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    };
  </script>
</body>
</html>
